generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId  String?  @unique
  name        String
  email       String   @unique
  password    String
  role        String   @default("Staff")
  branch      String
  phone       String?
  avatar      String?
  status      String   @default("Active")
  permissions String?  // Kept for backward compatibility/migration
  modulePermissions UserPermission[]
  lastActive  DateTime @default(now())
  tokenVersion Int     @default(0)
  
  tasksAssigned Task[]   @relation("AssignedTo")
  tasksCreated  Task[]   @relation("CreatedBy")

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model UserPermission {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  module    String   // e.g. "Inventory", "Tasks", "Employees", "Reports", "Settings", "Branches"
  canRead   Boolean  @default(false)
  canWrite  Boolean  @default(false)

  @@unique([userId, module])
}

model InventoryItem {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  productName String
  barcode     String?
  quantity    Int
  unit        String   @default("pcs")
  mfgDate     DateTime
  expDate     DateTime
  branch      String
  status      String
  notes       String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Task {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  priority    String   @default("Medium")
  status      String   @default("Open")
  dueDate     DateTime
  branch      String
  
  assignedToId String?  @db.ObjectId
  assignedTo   User?    @relation("AssignedTo", fields: [assignedToId], references: [id])
  assigneeName String?
  
  createdById  String?  @db.ObjectId
  createdBy    User?    @relation("CreatedBy", fields: [createdById], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Branch {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  address   String?
  phone     String?
  manager   String?
  status    String   @default("Active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
